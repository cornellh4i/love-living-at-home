{% extends "admin/request_manager/layouts/base.html" %}
{% import 'macros/form_macros.html' as f %}

{% block request_content %}

<style>
  .container {
    /* Center the content */
    align-items: center;
    display: flex;
    justify-content: center;

    /* Spacing */
    padding: 8px;
  }

  .container__triangle {
    border-style: solid;

    /* Size */
    height: 0px;
    width: 0px;
  }

  .container__triangle--right {
    border-color: transparent transparent transparent rgba(0, 0, 0, 0.3);
    border-width: 8px 0px 8px 8px;
  }

  .container__triangle--left {
    border-color: transparent rgba(0, 0, 0, 0.3) transparent transparent;
    border-width: 8px 8px 8px 0px;
  }
</style>

<div class="content-section">
  <form method="POST" action="">
    {{ form.hidden_tag() }}

    <h2 class="header">Search Criteria</h2>
    <hr />

    {% set flashes = {
    'error': get_flashed_messages(category_filter=['form-error']),
    'warning': get_flashed_messages(category_filter=['form-check-email']),
    'info': get_flashed_messages(category_filter=['form-info']),
    'success': get_flashed_messages(category_filter=['form-success'])
    } %}

    {{ f.begin_form(form, flashes) }}

    <div class="ui form">
      <!--Dropdown components-->
      <div class="ui two column stackable grid">
        <div class="eight wide column">
          <!--Javascript to implement Select All (in progress)-->
          <script type="text/javascript">
            $("select").on("click", function () {
              if ($(this).find(":selected").text() == "Select All") {
                if ($(this).attr("data-select") == "false")
                  $(this).attr("data-select", "true").find("option").prop("selected", true);
                else
                  $(this).attr("data-select", "false").find("option").prop("selected", false);
              }
            });
          </script>
          <div class="dropdown">
            <div class="field">
              <label> {{form.request_type.label}}</label>
              {{ form.request_type(size=5, class='form-control', multiple="multiple") }}
            </div>
            <div class="field">
              <label> {{form.request_status.label}}</label>
              {{ form.request_status(size=7, class='form-control', multiple="multiple") }}
            </div>
          </div>
        </div>

        <div class="right floated eight wide column">
          <div class="field">
            <label> {{form.service_category.label}}</label>
            {{ form.service_category(size=9, class='form-control', multiple="multiple") }}
          </div>
          <div class="field">
            <label> {{form.provider_type.label}}</label>
            {{ form.provider_type(size=4, class='form-control', multiple="multiple") }}
          </div>
        </div>
      </div>
      <script type="text/javascript">
        $(document).ready(function () {
          $('.ui.dropdown').dropdown({ fullTextSearch: true });
        });
      </script>
      <div class="field">
        <label> {{form.requesting_member.label}}</label>
        <select class="ui search selection dropdown" id="search-select">
          <option value="">Type Name Here</option>
          {% for choice in form.requesting_member.choices %}
          <option value={{ choice[0] }}>{{choice[1]}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="field">
        <label> {{form.service_provider.label}}</label>
        <select class="ui search dropdown">
          <option value="">Type Name Here</option>
          {% for choice in form.service_provider.choices %}
          <option value={{ choice[0] }}>{{choice[1]}}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <p>
      <hr />
    </p>

    <div class="ui form">
      <div class="ui two column stackable grid">
        <div class="eight wide column">
          <!--Put Calendar here-->


        </div>
        <div class="right floated eight wide column">
          <div class="inline fields">
            <label>{{ form.show.label }}:</label>
            {% for subfield in form.show %}
            <tr>
              <td>{{ subfield }}</td>
              &nbsp;&nbsp;&nbsp;&nbsp;
              <td>{{ subfield.label }}</td>
            </tr>
            {% endfor %}
          </div>

          <!-- <div class = "field"> -->
          <label>{{ form.time_period.label }}</label>
          <div class="inline fields">
            <button class="container" id="leftbutton">
              <!-- Triangle -->
              <div class="container__triangle container__triangle--left"></div>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <select class="ui dropdown" id="timePeriod" name="timePeriod">
              <option value="">Nothing Selected</option>
              {% for choice in form.time_period.choices %}
              <option value={{ choice[0] }}>{{choice[1]}}</option>
              {% endfor %}
            </select>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="container" id="rightbutton">
              <!-- Triangle -->
              <div class="container__triangle container__triangle--right"></div>
            </button>
            <!-- </div>  -->
          </div>

          <script text="text/javascript">
            document.getElementById("leftbutton").onclick = function () {

              var option = document.getElementById("timePeriod").value;
              var start_date = document.getElementById("startdate").value;
              var end_date = document.getElementById("enddate").value;
              var date_values = start_date.split("-");
              var year = parseInt(date_values[0]);
              var month = parseInt(date_values[1]) - 1;
              var date = parseInt(date_values[2]);
              var current = new Date(year, month, date);

              switch (option) {
                case '0':
                  var yesterday = new Date(current);
                  yesterday.setDate(yesterday.getDate() - 1)
                  var new_date = yesterday.getFullYear() + '-' + ("0" + (yesterday.getMonth() + 1)).slice(-2) + '-' + ("0" + yesterday.getDate()).slice(-2);
                  var end_date = new_date;
                  break;
                case '1':
                  var week_ = current.getDate() - 7;
                  var last_week = new Date(current.setDate(week_));
                  var end_week = new Date(current.setDate(current.getDate() + 7));
                  var new_date = last_week.getFullYear() + '-' + ("0" + (last_week.getMonth() + 1)).slice(-2) + '-' + ("0" + last_week.getDate()).slice(-2);
                  var end_date = end_week.getFullYear() + '-' + ("0" + (end_week.getMonth() + 1)).slice(-2) + '-' + ("0" + end_week.getDate()).slice(-2);
                  break;
                case '2':
                  var month_ = current.getMonth() - 1;
                  var last_month = new Date(current.setMonth(month_));
                  var end_month = new Date(current.setMonth(current.getMonth() + 1));
                  var new_date = last_month.getFullYear() + '-' + ("0" + (last_month.getMonth() + 1)).slice(-2) + '-' + ("0" + last_month.getDate()).slice(-2);
                  var end_date = end_month.getFullYear() + '-' + ("0" + (end_month.getMonth() + 1)).slice(-2) + '-' + ("0" + end_month.getDate()).slice(-2);
                  break;
                default:
                  var new_date = start_date;
              }

              var dateControl = document.querySelector('#startdate');
              dateControl.value = new_date;

              var dateControl2 = document.querySelector('#enddate');
              dateControl2.value = end_date;
            }
          </script>

          <script text="text/javascript">
            document.getElementById("rightbutton").onclick = function () {

              var option = document.getElementById("timePeriod").value;
              var start_date = document.getElementById("startdate").value;
              var end_date = document.getElementById("enddate").value;
              var date_values = start_date.split("-");
              var year = parseInt(date_values[0]);
              var month = parseInt(date_values[1]) - 1;
              var date = parseInt(date_values[2]);
              var current = new Date(year, month, date);

              switch (option) {
                case '0':
                  var tomorrow = new Date(current);
                  tomorrow.setDate(tomorrow.getDate() + 1)
                  var new_date = tomorrow.getFullYear() + '-' + ("0" + (tomorrow.getMonth() + 1)).slice(-2) + '-' + ("0" + tomorrow.getDate()).slice(-2);
                  var end_date = new_date;
                  break;
                case '1':
                  var week_ = current.getDate() + 7;
                  var next_week = new Date(current.setDate(week_));
                  var end_week = new Date(current.setDate(current.getDate() + 7));
                  var new_date = next_week.getFullYear() + '-' + ("0" + (next_week.getMonth() + 1)).slice(-2) + '-' + ("0" + next_week.getDate()).slice(-2);
                  var end_date = end_week.getFullYear() + '-' + ("0" + (end_week.getMonth() + 1)).slice(-2) + '-' + ("0" + end_week.getDate()).slice(-2);
                  break;
                case '2':
                  var month_ = current.getMonth() + 1;
                  var next_month = new Date(current.setMonth(month_));
                  var end_month = new Date(current.setMonth(current.getMonth() + 1));
                  var new_date = next_month.getFullYear() + '-' + ("0" + (next_month.getMonth() + 1)).slice(-2) + '-' + ("0" + next_month.getDate()).slice(-2);
                  var end_date = end_month.getFullYear() + '-' + ("0" + (end_month.getMonth() + 1)).slice(-2) + '-' + ("0" + end_month.getDate()).slice(-2);
                  break;
                default:
                  var new_date = start_date;
              }

              var dateControl = document.querySelector('#startdate');
              dateControl.value = new_date;

              var dateControl2 = document.querySelector('#enddate');
              dateControl2.value = end_date;
            }
          </script>

          <script text="text/javascript">
            $("select[name = timePeriod]").on("change", function () {
              var date = new Date();
              var start_date;
              var end_date;
              //YYYY-MM-DD                      

              switch ($(this).val()) {
                case '0':
                  var start_date = date.getFullYear() + '-' + ("0" + (date.getMonth() + 1)).slice(-2) + '-' + ("0" + date.getDate()).slice(-2);
                  var end_date = start_date;
                  break;
                case '1':
                  var first = date.getDate() - date.getDay() + 1; // First day is the day of the month - the day of the week
                  var last = first + 6;
                  var firstDay = new Date(date.setDate(first));
                  var lastDay = new Date(date.setDate(last));
                  var start_date = firstDay.getFullYear() + '-' + ("0" + (firstDay.getMonth() + 1)).slice(-2) + '-' + ("0" + firstDay.getDate()).slice(-2);
                  var end_date = lastDay.getFullYear() + '-' + ("0" + (lastDay.getMonth() + 1)).slice(-2) + '-' + ("0" + lastDay.getDate()).slice(-2);
                  break;
                case '2':
                  var firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
                  var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
                  var start_date = firstDay.getFullYear() + '-' + ("0" + (firstDay.getMonth() + 1)).slice(-2) + '-' + ("0" + firstDay.getDate()).slice(-2);
                  var end_date = lastDay.getFullYear() + '-' + ("0" + (lastDay.getMonth() + 1)).slice(-2) + '-' + ("0" + lastDay.getDate()).slice(-2);
                  break;
                case '3':
                  var tomorrow = new Date(date);
                  tomorrow.setDate(tomorrow.getDate() + 1);
                  var start_date = tomorrow.getFullYear() + '-' + ("0" + (tomorrow.getMonth() + 1)).slice(-2) + '-' + ("0" + tomorrow.getDate()).slice(-2);
                  var end_date = start_date;
                  break;
                default:
              }

              var dateControl = document.querySelector('#startdate');
              dateControl.value = start_date;
              //window.alert(dateControl.value);
              var dateControl2 = document.querySelector('#enddate');
              dateControl2.value = end_date;
            });
          </script>


          <div class="inline fields">
            <div>
              <label>{{ form.start_date.label }}:</label>
              <input type="date" id="startdate" name="trip-start" class="setDate" value="">
            </div>
            <div>
              <label>{{form.end_date.label}}:</label>
              <input type="date" id="enddate" name="trip-start" value="">
            </div>
          </div>
        </div>
      </div>
    </div>

  <p>
    <hr />
  </p>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <div class="ui form">
    <div class="ui centered grid">
      <div class="inline fields">
        <div>{{form.apply_filters}}</div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <div><input type="reset" value="Reset Filters"></div>
      </div>
    </div>

  </div>



</div>
</form>
</div>
{% endblock %}