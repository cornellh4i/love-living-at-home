{% extends "admin/request_manager/layouts/base.html" %}
{% import 'macros/form_macros.html' as f %}

{# Render a card for a single service request.
Parameters:
request_num,
request_status,
requested_date,
requested_day_of_week,
start_time,
end_time,
member_name,
volunteer_name,
request_type,
service,
created_date,
modified_date,
service_category,
member_number,
volunteer_id,
is_volunteer
#}
{% macro request_card(
request_num, request_status, requested_date, requested_day_of_week, start_time,
end_time, member_name, volunteer_name, request_type, service, created_date,
modified_date, service_category, member_number, volunteer_id, is_volunteer ) %}
<div class="ui one cards request-card" style="margin-top:20px">
  <div class="ui card">
    <div class="content" style="background-color: burlywood;">
      <div class="header">
        Request #{{request_num}}
        <div class="ui right floated request-status-value">
          {% if request_status == "Requested" %}
          <div class="ui yellow label">{{request_status}}</div>
          {% elif request_status == "Confirmed" %}
          <div class="ui green label">{{request_status}}</div>
          {% else %}
          <div class="ui red label">{{request_status}}</div>
          {% endif %}
        </div>
      </div>

    </div>
    <div class="content">
      <div class="ui grid">
        <div class="four wide column">
          <div class="ui card">
            <div class="content">
              <div class="header">{{requested_day_of_week}}</div>
            </div>
            <div class="content">
              <h2><span class="requested-date-value">{% if requested_date %}
                  {{requested_date}}
                  {% else %}
                  N/A
                  {% endif %}</span></h2>
            </div>
            <div class="extra content">
              <h3>{{start_time}} - {{end_time}}</h3>
            </div>
          </div>
        </div>
        <div class="six wide column">
          <h2><span class="requesting-member-value" data-value="{{member_number}}">{{member_name}}</span></h2>
          <h3> <em><span class="service-provider-role-value">{% if is_volunteer %}
                Volunteer
                {% else %}
                Local Resource
                {% endif %}</span>:</em>
            <span class="service-provider-value" data-value="{{volunteer_id}}">{{volunteer_name}}</span>
          </h3>
          <div class="ui label request-type-value" style="margin-bottom: 5px">{{request_type}}</div>

          <div class="ui label">
            <span class="service-category-value">{{service_category}}</span>:
            <div class="detail">{{service}}</div>
          </div>
        </div>
        <div class="six wide column">
          <div>
            <b style="font-size:1.3em">Created Date:</b>
            <p>{{created_date}}</p>
          </div>
          <div style="margin-top: 10px">
            <b style="font-size:1.3em">Modified Date:</b>
            <p>{{modified_date}}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endmacro %}

{# Render a multiple select dropdown field for filtering purposes.
Parameters:
field – Field object passed in through the form.
show_label – If true, text of selected menu items are displayed. Otherwise, only number selected is shown.
#}
<!-- MACRO: Render Filter Select Field -->
{% macro filter_select_field(field, show_label) %}
<div class="field {% if not show_label %} no label {% endif %}" id="{{field.name}}">
  <label style="margin-bottom:0">{{field.label.text}}</label>

  <div class="ui multiple selection dropdown fluid">
    <i class="dropdown icon"></i>
    <div class="default text">All</div>
    <div class="menu">
      {% for choice in field.choices %}
      <div class="item" data-value="{{choice[0]}}">{{choice[1]}}</div>
      {% endfor %}
    </div>
  </div>
</div>
{% endmacro %}

{% block request_content %}
{% assets 'search_request_css' %}
<link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}">
{% endassets %}

<div class="content-section">
  <h2 class="header">Search Criteria</h2>

  {% set flashes = {
  'error': get_flashed_messages(category_filter=['form-error']),
  'warning': get_flashed_messages(category_filter=['form-check-email']),
  'info': get_flashed_messages(category_filter=['form-info']),
  'success': get_flashed_messages(category_filter=['form-success'])
  } %}
  {{ f.begin_form(form, flashes) }}

  <div class="ui three column stackable grid">
    <div class="five wide column" style="padding-top: 0; padding-bottom:0">
      {{filter_select_field(form.service_category, false)}}
    </div>
    <div class="five wide column" style="padding-top: 0; padding-bottom:0">
      {{filter_select_field(form.service_category, false)}}
    </div>
    <div class="five wide column" style="padding-top: 0; padding-bottom:0">
      {{filter_select_field(form.request_status, false)}}
    </div>
  </div>

  <div class="ui two column stackable grid">
    <div class="eight wide column" style="padding-top: 0; padding-bottom: 0.2">
      <div>
        {{filter_select_field(form.requesting_member, true)}}
      </div>
      <div class="field" style="margin-bottom: 0">
        <label style="margin-bottom:0">Service Provider(s)</label>
        <div>
          <div class="ui menu">
            <div id="select-role" class="ui dropdown item">
              <div class="text">
                All roles
              </div>
              <i class="dropdown icon"></i>
              <div class="menu">
                <div class="item" data-value="">All roles</div>
                <div class="item" data-value="volunteer">Volunteers</div>
                <div class="item" data-value="local-resource">Local Resources</div>
              </div>
            </div>
            <div class="ui fluid multiple search selection dropdown">
              <i class="dropdown icon"></i>
              <div class="default text">All</div>
              <div class="menu" id="service-provider-menu">
                {% for service_provider_info in service_providers %}
                <div class="item" data-role="{{service_provider_info[0]}}" data-id="{{service_provider_info[1]}}">
                  {{service_provider_info[2]}}
                </div>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="field">
        <label style="margin-bottom:0">Request #</label>
        <input type="text">
      </div>
    </div>
    <div class="eight wide column" style="padding-top: 0.3; padding-bottom: 0; padding-left: 100px">
      <div class="inline fields">
        <label>Show...</label>
        <div class="field">
          <div class="ui checkbox">
            <input type="checkbox" name="frequency" checked="checked">
            <label>Dated</label>
          </div>
        </div>
        <div class="field">
          <div class="ui checkbox">
            <input type="checkbox" name="frequency">
            <label>Undated</label>
          </div>
        </div>
      </div>
      <div class="field" style="padding: 0; margin: 0">
        {{ f.render_form_field(form.date_type) }}
      </div>
      <div class="inline fields" style="padding: 0; margin: 0">
        <div class="ui icon button" id="leftbutton">
          <i class="caret left icon"></i>
        </div>
        <select class="ui dropdown" id="timePeriod" name="timePeriod">
          <option value="">Nothing Selected</option>
          {% for choice in form.time_period.choices %}
          <option value={{ choice[0] }}>{{choice[1]}}</option>
          {% endfor %}
        </select>
        <div class="ui icon button" id="rightbutton">
          <i class="caret right icon"></i>
        </div>
      </div>
      <div class="fields" style="padding: 0; margin: 0">
        <div class="field" style="padding:0">
          <label style="margin-bottom: 0">{{ form.start_date.label }}:</label>
          <input type="date" id="startdate" name="trip-start" class="setDate" value="">
        </div>
        <div class="field">
          <label style="margin-bottom: 0">{{form.end_date.label}}:</label>
          <input type="date" id="enddate" name="trip-start" value="">
        </div>
      </div>
    </div>
  </div>

  <div class="ui one column centered grid">
    <div class="ui button" type="submit" id="filter-button">Apply Filters</div>
  </div>
  {{f.end_form()}}


  <h2 class="header" class="divleft">Search Results</h2>
  <div id="" class="divright">({{num_requests}} Results Found)</div>

  <hr />
  <div id="request-search-results">
    {% for request in requests %}
    {{request_card(
    request.request_num, request.request_status,
    request.requested_date, request.requested_day_of_week,
    request.start_time,
    request.end_time, request.member_name, request.volunteer_name,
    request.request_type, request.service, request.created_date,
    request.modified_date, request.service_category, request.member_number, request.volunteer_id, request.is_volunteer)
    }}
    {% endfor %}
  </div>

  {% assets 'search_request_js' %}
  <script type="text/javascript" src="{{ ASSET_URL }}"></script>
  {% endassets %}
  {% endblock %}