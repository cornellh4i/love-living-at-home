{% extends "admin/request_manager/layouts/base.html" %}
{% import 'macros/form_macros.html' as f %}

{% block request_content %}

<style>
  .container {
    /* Center the content */
    align-items: center;
    display: flex;
    justify-content: center;

    /* Spacing */
    padding: 8px;
  }

  .container__triangle {
    border-style: solid;

    /* Size */
    height: 0px;
    width: 0px;
  }

  .container__triangle--right {
    border-color: transparent transparent transparent rgba(0, 0, 0, 0.3);
    border-width: 8px 0px 8px 8px;
  } 

  .container__triangle--left {
    border-color: transparent rgba(0, 0, 0, 0.3) transparent transparent;
    border-width: 8px 8px 8px 0px;
  } 

</style>

<div class="content-section">
  <form method="POST" action="">
    {{ form.hidden_tag() }}

    <h2 class="header">Search Criteria</h2>
    <hr />

    {% set flashes = {
    'error': get_flashed_messages(category_filter=['form-error']),
    'warning': get_flashed_messages(category_filter=['form-check-email']),
    'info': get_flashed_messages(category_filter=['form-info']),
    'success': get_flashed_messages(category_filter=['form-success'])
    } %}

    {{ f.begin_form(form, flashes) }}

    <div class="ui form">
      <!--Dropdown components-->
      <div class="ui two column stackable grid">
        <div class="eight wide column">
          <!--Javascript to implement Select All (in progress)-->
          <script type="text/javascript">
          $("select").on("click", function(){      
            if ($(this).find(":selected").text() == "Select All"){
              if ($(this).attr("data-select") == "false")
                $(this).attr("data-select", "true").find("option").prop("selected", true);
              else
                $(this).attr("data-select", "false").find("option").prop("selected", false);
            }
          });
          </script>
          <div class="dropdown">
            <div class="field">
              <label> {{form.request_type.label}}</label>
              {{ form.request_type(size=5, class='form-control', multiple="multiple") }}
            </div>
            <div class="field">
              <label> {{form.request_status.label}}</label>
              {{ form.request_status(size=7, class='form-control', multiple="multiple") }}
            </div>
          </div>
        </div>

        <div class="right floated eight wide column">
          <div class="field">
            <label> {{form.service_category.label}}</label>
            {{ form.service_category(size=9, class='form-control', multiple="multiple") }}
          </div>
          <div class="field">
            <label> {{form.provider_type.label}}</label>
            {{ form.provider_type(size=4, class='form-control', multiple="multiple") }}
          </div>
        </div>
      </div>
      <script type="text/javascript">
        $(document).ready(function(){
          $('.ui.dropdown') .dropdown({ fullTextSearch: true });
        });
      </script>
      <div class="field">
        <label> {{form.requesting_member.label}}</label>        
        <select class="ui search selection dropdown" id="search-select">
          <option value="">Type Name Here</option>
          {% for choice in form.requesting_member.choices %}
          <option value={{ choice[0] }}>{{choice[1]}}</option>
          {% endfor %}
        </select>
      </div>
      <div class="field">
        <label> {{form.service_provider.label}}</label>
        <select class="ui search dropdown">
          <option value="">Type Name Here</option>
          {% for choice in form.service_provider.choices %}
          <option value={{ choice[0] }}>{{choice[1]}}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <p><hr /></p>

    <div class="ui form">
      <div class="ui two column stackable grid">
        <div class="eight wide column">
          <!--Put Calendar here-->


        </div>
        <div class="right floated eight wide column">
          <div class="inline fields">
            <label>{{ form.show.label }}:</label>
            {% for subfield in form.show %}
            <tr>
                <td>{{ subfield }}</td>
                &nbsp;&nbsp;&nbsp;&nbsp;
                <td>{{ subfield.label }}</td>
            </tr>
            {% endfor %}        
          </div>

          <!-- <div class = "field"> -->
            <label>{{ form.time_period.label }}</label>
            <div class="inline fields">
            <button class="container">
              <!-- Triangle -->
              <div class="container__triangle container__triangle--left"></div>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <select class="ui dropdown" id="timePeriod">
              <option value="">Nothing Selected</option>
              {% for choice in form.time_period.choices %}
              <option value={{ choice[0] }}>{{choice[1]}}</option>
              {% endfor %}
            </select>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="container">
              <!-- Triangle -->
              <div class="container__triangle container__triangle--right"></div>
            </button>
          <!-- </div>  -->
          </div>
          
          <script text="text/javascript">
          $(document).ready( function() {
          
            var e = document.getElementById("timePeriod");
            var strUser = e.value;
            if (strUser == 0){
              var date = new Date();
              var start_date = date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate(); 
              var end_date = start_date;
            } else if (strUser == 1) {
              var curr = new Date; // get current date
              var first = curr.getDate() - curr.getDay(); // First day is the day of the month - the day of the week
              var last = first + 6;
              var start_date = first.getFullYear()+'-'+(first.getMonth()+1)+'-'+first.getDate() ;
              var end_date = last.getFullYear()+'-'+(last.getMonth()+1)+'-'+last.getDate() ;
            } else if (strUser == 2) {
              var date = new Date();
              var firstDay = new Date(date.getFullYear(), date.getMonth(), 1);
              var lastDay = new Date(date.getFullYear(), date.getMonth() + 1, 0);
              var start_date = firstDay.getFullYear()+'-'+(firstDay.getMonth()+1)+'-'+firstDay.getDate();
              var end_date = lastDay.getFullYear()+'-'+(lastDay.getMonth()+1)+'-'+lastDay.getDate();
            } else if (strUser == 3) {
              var today = new Date();
              var tomorrow = new Date(today);
              tomorrow.setDate(tomorrow.getDate() + 1);
              var start_date = (tomorrow.getMonth()+1)+'/'+tomorrow.getDate()+'/'+ tomorrow.getFullYear();
              var end_date = start_date;
            } else {
              var date = new Date();
              var start_date = date.getFullYear()+'-'+(date.getMonth()+1)+'-'+date.getDate(); 
              var end_date = start_date;
            }
            var dateControl = document.querySelector('input[type="date"]');
            dateControl.value = str(start_date);
            //$('#startdate').val(start_date);
            //$('#enddate').val(end_date);
            //document.getElementById('startdate').value = start_date;      
            //document.getElementById('enddate').value = end_date;
          });
          </script>
          <div class="inline fields">
            <div>
              <label>{{ form.start_date.label }}:</label>
              <input type="date" id="startdate" name="trip-start"
                value=>
            </div>
            <div>
              <label>{{form.end_date.label}}:</label> 
              <input type="date" id="enddate" name="trip-start"
                value=>
            </div>
          </div>
        </div>
      </div>
    </div>

    <p><hr /></p>
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <div class = "ui form">
      <div class = "ui centered grid">
      <div class="inline fields">
        <div>{{form.apply_filters}}</div>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <div>{{form.reset_filters}}</div>
      </div>
    </div>

    </div>


    
</div>
</form>
</div>
{% endblock %}