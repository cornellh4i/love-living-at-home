{% extends 'admin/request_manager/create_request.html' %}
{% import 'macros/form_macros.html' as f %}

{% block scripts %}
{% endblock %}

{% block create_request_content %}
{% set flashes = {
'error': get_flashed_messages(category_filter=['form-error']),
'warning': get_flashed_messages(category_filter=['form-check-email']),
'info': get_flashed_messages(category_filter=['form-info']),
'success': get_flashed_messages(category_filter=['form-success'])
} %}

<style>
    .column {
      position: relative;
    }

    .column .side-button {
      position: absolute;
      bottom: 0;
      left: 0;
    }
  </style>

{{ f.begin_form(form, flashes, extra_classes="large") }}
<div class="ui stackable centered grid container">
  <div class="twelve wide column">
    <h2 class="ui center aligned header">Member's Home Request Form</h2>
  </div>

  <div class="twelve wide column">
    <div class="ui two column stackable grid">
      <div class="six wide column">
        {{ f.render_form_field(form.date_created) }}
      </div>
    </div>
  </div>

  <div class="twelve wide column">
    {{ f.render_form_field(form.requesting_member)}}
  </div>

  <div class="twelve wide column">
    <div class="ui two column stackable relaxed grid">
      <div class="two column row">
        <div class="six wide column">
          {{ f.render_form_field(form.requested_date) }}
        </div>
        <div class="right floated six wide column">
          {{ f.render_form_field(form.time_flexible) }}
        </div>
      </div>
      <div class="two column row">
        <div class="six wide column">
          {{ f.render_form_field(form.time_from) }}
        </div>
        <div class="right floated six wide column">
          {{ f.render_form_field(form.time_until) }}
        </div>
      </div>
    </div>
  </div>

  <div class="twelve wide column">
    {{ f.render_form_field(form.description) }}
  </div>

    <div class = "twelve wide column">
    <div>{{ f.render_form_field(form.home_location) }}</div>
    </div>

  <div class="twelve wide column">
    <div class="ui two column stackable grid">
      <div class="six wide column">
        {{ f.render_form_field(form.service_category) }}
      </div>
      <div class="right floated six wide column">
        <div id="techServices" style = "display: initial">
          {{ f.render_form_field(form.tech_services) }}
        </div>
        <div id="profHomeServices" style = "display: none">
          {{ f.render_form_field(form.prof_home_services) }}
        </div>
        <div id="profSupportServices" style = "display: none">
          {{ f.render_form_field(form.prof_support_services) }}
        </div>
        <div id="volHomeServices" style = "display: none">
          {{ f.render_form_field(form.vol_home_services) }}
        </div>
        <div id="volSupportServices" style = "display: none">
          {{ f.render_form_field(form.vol_support_services) }}
        </div>
      </div>
      <div class="right floated six wide column"></div>
    </div>

    <div class="twelve wide column">
      {{ f.render_form_field(form.service_provider)}}
    </div>

    <div class="four fields">
      <div class="field">
        <button class="ui purple basic button" type="button">
          Send Request
        </button>
      </div>
      <div class="field">
        <button class="ui purple basic button" type="button">
          Confirmation
        </button>
      </div>
      <div class="field">
        <button class="ui purple basic button" type="button">Not Needed</button>
      </div>
      <div class="field">
        <button class="ui purple basic button" type="button">Summary</button>
      </div>
    </div>
  </div>

  <div id="new-service-provider" class="ui modal">
    <i class="close icon"></i>
    <div class="header">Add Service Provider</div>
    <div class="content">
      <h3>Add New Service Provider</h3>
    </div>
  </div>

  <p id="special-instructions" style="display: none">
    {{form.special_instructions_list}}
  </p>

  <div class="twelve wide column">
    <div class="field" id="special-instructions-div">
      {{ f.render_form_field(form.special_instructions) }}
    </div>
  </div>

  <div class="twelve wide column">
    <div class="ui two column stackable grid">
      <div class="six wide column">
        {{ f.render_form_field(form.follow_up_date) }} {{
        f.render_form_field(form.responsible_staffer) }}
      </div>
      <div class="right floated six wide column">
        {{ f.render_form_field(form.status) }} {{
        f.render_form_field(form.contact_log_priority) }}
      </div>
    </div>
  </div>

  <div class="twelve wide column">
    {{ f.render_form_field(form.person_to_cc) }}
  </div>

  <script>
    $('#show-new-destination').click(function () {
      $('#new-destination').modal('show');
    });

    $('#show-new-service-provider').click(function () {
      $('#new-service-provider').modal('show');
    });

    function serviceChoices() {
      let service_category = document.getElementById('service_category').value;
      console.log("got:" + service_category)
      const dropdowns = new Map();
      dropdowns.set(3, document.getElementById("techServices"));
      dropdowns.set(4, document.getElementById("profHomeServices"));
      dropdowns.set(5, document.getElementById("profSupportServices"));
      dropdowns.set(7, document.getElementById("volHomeServices"));
      dropdowns.set(8, document.getElementById("volSupportServices"));
      const cat_ids = [3, 4, 5, 7, 8];
      cat_ids.forEach(id => {
        if (id == service_category)
          dropdowns.get(id).style.display = "initial";
        else
          dropdowns.get(id).style.display = "none";
      })
    }

    function specialInstructions() {
      let member_id = document.getElementById('member').value.toString();
      $('#special-instructions-div').empty();
      let str = document.getElementById('special-instructions').innerHTML;
      let obj = JSON.parse(str);
      $('#special-instructions-div').append(
        '<label class = "ui form field">Special Instructions:</label>'
      );
      $('#special-instructions-div').append(
        '<textarea name="special_instructions" class="ui textArea" >' +
          obj[member_id] +
          '</textarea>'
      );
      special_input = obj[member_id];
    }
  </script>

  <div class="twelve wide column">
    {{ f.form_message(flashes['error'], header='Something went wrong.', class='error') }}
    {{ f.form_message(flashes['warning'], header='Check your email.', class='warning') }}
    {{ f.form_message(flashes['info'], header='Information', class='info') }}
    {{ f.form_message(flashes['success'], header='Success!', class='success') }}

    {{ f.render_form_field(form.submit, extra_classes=".ui .button") }}

    {{ f.end_form() }}
  </div>
</div>

{% endblock %}
